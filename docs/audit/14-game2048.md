# 14. Example: game2048 DQN

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê (2/5)

---

## Experience Collection

| –ê—Å–ø–µ–∫—Ç | –ó–∞–¥—É–º–∞–Ω–æ | –†–µ–∞–ª—å–Ω–æ |
|--------|----------|---------|
| Parallel envs | rayon | üü¢ 32 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—ã |
| Thread-local agents | –ò–∑–±–µ–∂–∞—Ç—å lock | üü¢ `thread_local!` |
| Zero-alloc states | Fixed arrays | üü¢ `[f32; 256]` |

---

## `compute_targets`

| –ê—Å–ø–µ–∫—Ç | –ó–∞–¥—É–º–∞–Ω–æ | –†–µ–∞–ª—å–Ω–æ |
|--------|----------|---------|
| Parallel forward | ‚úì | üü¢ `forward_batch_parallel` |
| Policy network | batch forward | üü¢ |
| Target network | batch forward | üü¢ |

**–ò—Å—Ç–æ—Ä–∏—è:** –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ 11-15 ep/s, –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ 40-50 ep/s.

---

## `ReplayBuffer`

| –ê—Å–ø–µ–∫—Ç | –ó–∞–¥—É–º–∞–Ω–æ | –†–µ–∞–ª—å–Ω–æ |
|--------|----------|---------|
| Ring buffer | Circular overwrite | üü¢ |
| sample_batch_into | Pre-allocated | üü¢ |
| Lock contention | RwLock | üü° –í—Å—ë –µ—â—ë –µ—Å—Ç—å |

**TODO:** Lock-free sampling –∏–ª–∏ sharded buffer.

---

## –í—ã–≤–æ–¥—ã

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| Parallel collection | üü¢ –†–∞–±–æ—Ç–∞–µ—Ç |
| Performance | üü¢ 40-50 ep/s |
| Automated tests | üî¥ –ù–µ—Ç |

**–û—Ü–µ–Ω–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤:** ‚≠ê‚≠ê (2/5)
- ‚úÖ Manual testing –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç learning signal
- ‚ö†Ô∏è –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤
- ‚ö†Ô∏è –ù–µ—Ç unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è ReplayBuffer
- ‚ùå Performance –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è CI

---

## –ú–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã

| –û–±–ª–∞—Å—Ç—å | –†–∏—Å–∫ | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|------|----------|
| DQN target Q-value | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–µ—Ç —Ç–µ—Å—Ç–∞ Bellman equation |
| ReplayBuffer sampling | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–µ—Ç —Ç–µ—Å—Ç–∞ —á—Ç–æ sampling fair |
| Epsilon decay | üü° –°—Ä–µ–¥–Ω–∏–π | –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è exploration |
| Terminal state | üü° –°—Ä–µ–¥–Ω–∏–π | Q(terminal) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0 |
| Reward clipping | üü° –°—Ä–µ–¥–Ω–∏–π | –ù–µ—Ç —Ç–µ—Å—Ç–∞ —á—Ç–æ rewards bounded |
