# Copilot Instructions for ArKan

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: docs/audit/

**–ü—Ä–∏ –ª—é–±–æ–π —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º:**

1. –ï—Å–ª–∏ `docs/audit/` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ —à–∞–±–ª–æ–Ω—É
2. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ/–∏–∑–º–µ–Ω—ë–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –∞—É–¥–∏—Ç–∞
3. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –º–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã, —Ä–∏—Å–∫–∏, —Å–æ–º–Ω–µ–Ω–∏—è ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –≤ –∞—É–¥–∏—Ç
4. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫–∏ ‚Äî **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ü–ò–°–ê–¢–¨**
5. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –¥–æ–ª–≥–æ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –≤ –∞—É–¥–∏—Ç –∫–∞–∫ TODO

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ docs/audit/

```
docs/audit/
‚îú‚îÄ‚îÄ README.md              # –ò–Ω–¥–µ–∫—Å –∏ —Å–≤–æ–¥–∫–∞ –ø–æ –º–æ–¥—É–ª—è–º
‚îú‚îÄ‚îÄ 00-bspline.md          # B-Spline computation
‚îú‚îÄ‚îÄ 01-cpu-forward.md      # CPU forward pass
‚îú‚îÄ‚îÄ 02-cpu-backward.md     # CPU backward pass
‚îú‚îÄ‚îÄ 03-cpu-training.md     # CPU training
‚îú‚îÄ‚îÄ 04-gpu-forward.md      # GPU forward pass
‚îú‚îÄ‚îÄ 05-gpu-backward.md     # GPU backward pass
‚îú‚îÄ‚îÄ 06-gpu-training.md     # GPU training
‚îú‚îÄ‚îÄ 07-optimizers.md       # Adam, SGD, LBFGS, GpuAdam
‚îú‚îÄ‚îÄ 08-memory.md           # Memory management
‚îú‚îÄ‚îÄ 09-serialization.md    # Serialization
‚îú‚îÄ‚îÄ 10-error-handling.md   # Error handling
‚îú‚îÄ‚îÄ 11-loss-functions.md   # Loss functions
‚îú‚îÄ‚îÄ 12-baked-model.md      # BakedModel
‚îú‚îÄ‚îÄ 13-config.md           # KanConfig & ConfigBuilder
‚îî‚îÄ‚îÄ 14-examples.md         # Examples (basic, training, GPU, sinusoid, MNIST, game2048)
```

## –ü—Ä–∏–Ω—Ü–∏–ø —á–µ—Å—Ç–Ω–æ—Å—Ç–∏

‚ùå **–ù–ï –ø–æ–¥–≥–æ–Ω—è—Ç—å —Ç–µ—Å—Ç—ã –ø–æ–¥ –æ—Ç–≤–µ—Ç**

–ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É:
1. –ó–∞–ø–∏—Å–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –∞—É–¥–∏—Ç–∞ (—Å–µ–∫—Ü–∏—è "–ú–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã")
2. –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Å—Ç —Å –æ—à–∏–±–∫–æ–π ‚Äî –ø—É—Å—Ç—å –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
4. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –¥—Ä—É–≥–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏

**–ì–ª–∞–≤–Ω–æ–µ ‚Äî —á–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–¥–∞, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ –Ω—ë–º.**

---

## –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –∞—É–¥–∏—Ç–∞ –º–æ–¥—É–ª—è

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª `XX-module-name.md` –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç:

```markdown
# X. Module Name

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

## X.1 `function_name`

| –ê—Å–ø–µ–∫—Ç | –ó–∞–¥—É–º–∞–Ω–æ | –†–µ–∞–ª—å–Ω–æ |
|--------|----------|---------|
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | ... | üü¢/üü°/üî¥ |

**–¢–µ—Å—Ç—ã:**
| –¢–µ—Å—Ç | –§–∞–π–ª | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|------|------|---------------|--------|
| `test_xxx` | `file.rs` | ... | üü¢/üü°/üî¥ |

---

## X.2 `another_function`
...

---

## X.N –í—ã–≤–æ–¥—ã

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| ... | üü¢/üü°/üî¥ |

**–û—Ü–µ–Ω–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)
- ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ
- ‚ö†Ô∏è –ß—Ç–æ —Å—Ä–µ–¥–Ω–µ
- ‚ùå –ß—Ç–æ –ø–ª–æ—Ö–æ

---

## X.N+1 –ú–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã

| –û–±–ª–∞—Å—Ç—å | –†–∏—Å–∫ | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|------|----------|
| ... | üî¥/üü°/üü¢ | ... |
```

## –§–æ—Ä–º–∞—Ç README.md (–∏–Ω–¥–µ–∫—Å)

```markdown
# ArKan Functionality Audit

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞—É–¥–∏—Ç–∞:** [–¥–∞—Ç–∞]
**–í–µ—Ä—Å–∏—è:** [–≤–µ—Ä—Å–∏—è]

## üìä –†–µ–π—Ç–∏–Ω–≥ –ø–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | –§–∞–π–ª |
|--------|--------|-------------|------|
| B-Spline | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) | ... | [00-bspline.md](00-bspline.md) |
| ... | ... | ... | ... |

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã

| –ó–æ–Ω–∞ | –ú–æ–¥—É–ª—å | –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è |
|------|--------|-------------|
| ... | ... | ... |

## üìã –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è | –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å |
|-----------|-----------------|------------|
| ... | ... | ‚≠ê‚≠ê‚≠ê |
```

---

## –õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

- üü¢ = —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ / –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫
- üü° = —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç / —Å—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫  
- üî¥ = –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç / –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫

## –û—Ü–µ–Ω–∫–∏ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤

- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) ‚Äî –≠—Ç–∞–ª–æ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (scipy parity, mathematical invariants)
- ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) ‚Äî –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (numerical checks, parity tests)
- ‚≠ê‚≠ê‚≠ê (3/5) ‚Äî –°—Ä–µ–¥–Ω–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (convergence only, –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- ‚≠ê‚≠ê (2/5) ‚Äî –°–ª–∞–±–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (—Ç–æ–ª—å–∫–æ manual testing)
- ‚≠ê (1/5) ‚Äî –ù–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è

---

## –ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å –∞—É–¥–∏—Ç

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω/–∏–∑–º–µ–Ω—ë–Ω —Ç–µ—Å—Ç
- ‚úÖ –ù–∞–π–¥–µ–Ω –±–∞–≥
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥
- ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –º–µ—Ä—Ç–≤–∞—è –∑–æ–Ω–∞
- ‚úÖ –ï—Å—Ç—å —Å–æ–º–Ω–µ–Ω–∏—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏

### –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- Performance –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π

### –ù–∞–π–¥–µ–Ω –±–∞–≥:
```markdown
### N+4. Action Items

### High Priority üî¥
1. **Serialization —Ç–µ—Ä—è–µ—Ç knots** ‚Äî KanLayer.knots –∏–º–µ–µ—Ç `#[serde(skip)]`, 
   –ø–æ—Å–ª–µ deserialize knots –ø—É—Å—Ç–æ–π ‚Üí panic –ø—Ä–∏ forward
```

### –°–æ–º–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:
```markdown
#### 1.3.5. –ú–µ—Ä—Ç–≤—ã–µ –∑–æ–Ω—ã
| –û–±–ª–∞—Å—Ç—å | –†–∏—Å–∫ | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|------|----------|
| SIMD accumulate_simd4 | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞, –±–∞–≥ –ø—Ä–æ—è–≤–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö |
```

### –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç:
```markdown
### N+4. Action Items

### High Priority üî¥
1. **test_gradient_check_order4 fails** ‚Äî rel_err=0.12 –ø—Ä–∏ –æ–∂–∏–¥–∞–µ–º–æ–º <0.05,
   –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ—è—Å–Ω–∞. –û—Å—Ç–∞–≤–ª–µ–Ω failing, —Ç—Ä–µ–±—É–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ ArKan

- **–Ø–∑—ã–∫:** Rust
- **GPU:** wgpu compute shaders
- **–¢–µ—Å—Ç—ã:** `cargo test`, `#[ignore]` –¥–ª—è GPU —Ç–µ—Å—Ç–æ–≤
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `cargo fmt`
- **–õ–∏–Ω—Ç–µ—Ä:** `cargo clippy -- -D warnings`
- **–ë–µ–Ω—á–º–∞—Ä–∫–∏:** criterion (`cargo bench`)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:
- `tests/` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `src/*.rs` ‚Äî unit —Ç–µ—Å—Ç—ã –≤ `#[cfg(test)] mod tests`
- `benches/` ‚Äî performance benchmarks

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `docs/audit/README.md` ‚Äî –∏–Ω–¥–µ–∫—Å –∞—É–¥–∏—Ç–∞
- `docs/audit/*.md` ‚Äî –º–æ–¥—É–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∞—É–¥–∏—Ç–∞
- `docs/ARCHITECTURE.md` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `docs/BENCHMARKS.md` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
